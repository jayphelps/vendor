// ==========================================================================
// Project:   Ember Data
// Copyright: ©2011-2012 Tilde Inc. and contributors.
//            Portions ©2011 Living Social Inc. and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================



// Last commit: 7c387e9 (2013-06-23 20:29:36 -0700)


(function(){Ember.Adapter=Ember.Object.extend({find:function(){throw new Error("Ember.Adapter subclasses must implement find")},findQuery:function(){throw new Error("Ember.Adapter subclasses must implement findQuery")},findMany:function(){throw new Error("Ember.Adapter subclasses must implement findMany")},findAll:function(){throw new Error("Ember.Adapter subclasses must implement findAll")},load:function(r,e,t){r.load(e,t)},createRecord:function(){throw new Error("Ember.Adapter subclasses must implement createRecord")},saveRecord:function(){throw new Error("Ember.Adapter subclasses must implement saveRecord")},deleteRecord:function(){throw new Error("Ember.Adapter subclasses must implement deleteRecord")}})})(),function(){var r=Ember.get;Ember.FixtureAdapter=Ember.Adapter.extend({find:function(e,t){var i=e.constructor.FIXTURES,n=r(e.constructor,"primaryKey"),o=Ember.A(i).find(function(r){return r[n]===t});return e.get("isLoaded")||setTimeout(function(){Ember.run(e,e.load,t,o)}),e},findMany:function(r,e,t){for(var i=r.FIXTURES,n=[],o=0,s=t.length;s>o;o++)n.push(i[o]);return setTimeout(function(){Ember.run(e,e.load,r,n)}),e},findAll:function(r,e){var t=r.FIXTURES;return setTimeout(function(){Ember.run(e,e.load,r,t)}),e},createRecord:function(r){var e=r.constructor,t=e.FIXTURES;return setTimeout(function(){Ember.run(function(){t.push(e.findFromCacheOrLoad(r.toJSON())),r.didCreateRecord()})}),r},saveRecord:function(r){var e=Ember.Deferred.create();return e.then(function(){r.didSaveRecord()}),setTimeout(function(){Ember.run(e,e.resolve,r)}),e},deleteRecord:function(r){var e=Ember.Deferred.create();return e.then(function(){r.didDeleteRecord()}),setTimeout(function(){Ember.run(e,e.resolve,r)}),e}})}(),function(){var r=Ember.get,e=Ember.set;Ember.RecordArray=Ember.ArrayProxy.extend(Ember.Evented,Ember.DeferredMixin,{isLoaded:!1,isLoading:Ember.computed.not("isLoaded"),load:function(r,t){e(this,"content",this.materializeData(r,t)),this.notifyLoaded()},loadForFindMany:function(t){var i=r(this,"_ids").map(function(r){return t.cachedRecordForId(r)});e(this,"content",Ember.A(i)),this.notifyLoaded()},notifyLoaded:function(){e(this,"isLoaded",!0),this.trigger("didLoad"),this.resolve(this)},materializeData:function(r,e){return Ember.A(e.map(function(e){return r.findFromCacheOrLoad(e)}))}})}(),function(){var r=Ember.get;Ember.FilteredRecordArray=Ember.RecordArray.extend({init:function(){if(!r(this,"modelClass"))throw new Error("FilteredRecordArrays must be created with a modelClass");if(!r(this,"filterFunction"))throw new Error("FilteredRecordArrays must be created with a filterFunction");if(!r(this,"filterProperties"))throw new Error("FilteredRecordArrays must be created with filterProperties");var e=r(this,"modelClass");e.registerRecordArray(this),this.registerObservers(),this.updateFilter()},updateFilter:function(){var e=this,t=[];r(this,"modelClass").forEachCachedRecord(function(r){e.filterFunction(r)&&t.push(r)}),this.set("content",Ember.A(t))},updateFilterForRecord:function(e){var t=r(this,"content");this.filterFunction(e)&&t.pushObject(e)},registerObservers:function(){var e=this;r(this,"modelClass").forEachCachedRecord(function(r){e.registerObserversOnRecord(r)})},registerObserversOnRecord:function(e){for(var t=this,i=r(this,"filterProperties"),n=0,o=r(i,"length");o>n;n++)e.addObserver(i[n],t,"updateFilterForRecord")}})}(),function(){var r=Ember.get;Ember.HasManyArray=Ember.RecordArray.extend({_records:null,objectAtContent:function(e){var t=r(this,"modelClass"),i=r(this,"content");if(i.length){var n=i.objectAt(e);if(this._records&&this._records[e])return this._records[e];var o=t.create();this._records||(this._records={}),this._records[e]=o;var s=r(t,"primaryKey");return o.load(n[s],n),o}},create:function(e){var t=r(this,"modelClass"),i=t.create(e);return this.pushObject(e),this._records||(this._records={}),this._records[r(this,"length")-1]=i,i},save:function(){return Ember.RSVP.all(this.map(function(r){return r.save()}))}})}(),function(){function r(r,e){for(var t=0,i=r.length;i>t;t++)if(r[t]===e)return!0;return!1}function e(e,t){for(var i,n=0,o=t.length;o>n;n++)i=t[n],r(e,i)||e.push(i);return e}function t(r,e){var t=s(r,!1);return t?e in t.cache:void 0}var i=Ember.get,n=Ember.set,o=Ember.setProperties,s=Ember.meta,a=Ember.String.underscore;Ember.run.queues.push("data"),Ember.Model=Ember.Object.extend(Ember.Evented,Ember.DeferredMixin,{isLoaded:!0,isLoading:Ember.computed.not("isLoaded"),isNew:!0,isDeleted:!1,_dirtyAttributes:null,isDirty:Ember.computed(function(){for(var r,e,n,o,a,d,c,u=this.attributes,h=Ember.A(),f=0,l=u.length;l>f;f++)r=u[f],t(this,r)&&(e=this.cacheFor(r),n=i(this,"data."+this.dataKey(r)),o=s(this).descs[r],a=o&&o.meta(),d=a.type,c=d&&d.isEqual?!d.isEqual(n,e):n!==e?!0:!1,c&&h.push(r));return h.length?(this._dirtyAttributes=h,!0):(this._dirtyAttributes=[],!1)}).property().volatile(),dataKey:function(r){var e=i(this.constructor,"camelizeKeys");return e?a(r):r},init:function(){i(this,"isNew")||this.resolve(this),this._super()},load:function(r,e){var t={};t[i(this.constructor,"primaryKey")]=r,n(this,"data",Ember.merge(t,e)),n(this,"isLoaded",!0),n(this,"isNew",!1),this.trigger("didLoad"),this.resolve(this)},didDefineProperty:function(r,e,t){if(t instanceof Ember.Descriptor){var i=t.meta();i.isAttribute&&(r.attributes||(r.attributes=[]),r.attributes.push(e))}},toJSON:function(){var r,e,t=this.getProperties(this.attributes);for(r in t)e=this.constructor.metaForProperty(r),e.type&&e.type.serialize?t[r]=e.type.serialize(t[r]):e.type&&Ember.Model.dataTypes[e.type]&&(t[r]=Ember.Model.dataTypes[e.type].serialize(t[r]));return t},save:function(){var r=this.constructor.adapter;if(n(this,"isSaving",!0),i(this,"isNew"))return r.createRecord(this);if(i(this,"isDirty"))return r.saveRecord(this);var e=Ember.Deferred.create();return e.resolve(this),n(this,"isSaving",!1),e},reload:function(){return this.constructor.reload(this.get(i(this.constructor,"primaryKey")))},revert:function(){if(this.get("isDirty")){for(var r=i(this,"data"),e={},t=0;this._dirtyAttributes.length>t;t++){var n=this._dirtyAttributes[t];e[n]=r[n]}o(this,e)}},didCreateRecord:function(){var r=i(this.constructor,"primaryKey"),e=i(this,r);n(this,"isNew",!1),this.constructor.recordCache||(this.constructor.recordCache={}),this.constructor.recordCache[e]=this,this.load(e,this.getProperties(this.attributes)),this.constructor.addToRecordArrays(this),this.trigger("didCreateRecord"),this.didSaveRecord()},didSaveRecord:function(){n(this,"isSaving",!1),this.trigger("didSaveRecord"),this.get("isDirty")&&this._copyDirtyAttributesToData()},deleteRecord:function(){return this.constructor.adapter.deleteRecord(this)},didDeleteRecord:function(){this.constructor.removeFromRecordArrays(this),n(this,"isDeleted",!0),this.trigger("didDeleteRecord")},_copyDirtyAttributesToData:function(){if(this._dirtyAttributes){var r,e=this._dirtyAttributes,t=i(this,"data");t||(t={},n(this,"data",t));for(var o=0,s=e.length;s>o;o++)r=e[o],t[this.dataKey(r)]=this.cacheFor(r);this._dirtyAttributes=[]}}}),Ember.Model.reopenClass({primaryKey:"id",adapter:Ember.Adapter.create(),find:function(r){return arguments.length?Ember.isArray(r)?this.findMany(r):"object"==typeof r?this.findQuery(r):this.findById(r):this.findAll()},findMany:function(r){var t=Ember.RecordArray.create({_ids:r});return this.recordArrays||(this.recordArrays=[]),this.recordArrays.push(t),this._currentBatchIds?(e(this._currentBatchIds,r),this._currentBatchRecordArrays.push(t)):(this._currentBatchIds=e([],r),this._currentBatchRecordArrays=[t]),Ember.run.scheduleOnce("data",this,this._executeBatch),t},findAll:function(){if(this._findAllRecordArray)return this._findAllRecordArray;var r=this._findAllRecordArray=Ember.RecordArray.create();return this.adapter.findAll(this,r),r},_currentBatchIds:null,_currentBatchRecordArrays:null,findById:function(r){var e=this.cachedRecordForId(r);return i(e,"isLoaded")||this._fetchById(e,r),e},reload:function(r){var e=this.cachedRecordForId(r);return this._fetchById(e,r),e},_fetchById:function(e,t){var n=i(this,"adapter");n.findMany?(this._currentBatchIds?r(this._currentBatchIds,t)||this._currentBatchIds.push(t):(this._currentBatchIds=[t],this._currentBatchRecordArrays=[]),Ember.run.scheduleOnce("data",this,this._executeBatch)):n.find(e,t)},_executeBatch:function(){var r,e=this._currentBatchIds,t=this._currentBatchRecordArrays,n=this;this._currentBatchIds=null,this._currentBatchRecordArrays=null,1===e.length?r=i(this,"adapter").find(this.cachedRecordForId(e[0]),e[0]):(r=Ember.RecordArray.create({_ids:e}),i(this,"adapter").findMany(this,r,e)),r.then(function(){for(var r=0,e=t.length;e>r;r++)t[r].loadForFindMany(n)})},findQuery:function(r){var e=Ember.RecordArray.create();return this.adapter.findQuery(this,e,r),e},cachedRecordForId:function(r){this.recordCache||(this.recordCache={});var e;if(this.recordCache[r])e=this.recordCache[r];else{e=this.create({isLoaded:!1});var t=this.sideloadedData&&this.sideloadedData[r];t&&e.load(r,t),this.recordCache[r]=e}return e},addToRecordArrays:function(r){this._findAllRecordArray&&this._findAllRecordArray.pushObject(r),this.recordArrays&&this.recordArrays.forEach(function(e){e instanceof Ember.FilteredRecordArray?(e.registerObserversOnRecord(r),e.updateFilter()):e.pushObject(r)})},removeFromRecordArrays:function(r){this._findAllRecordArray&&this._findAllRecordArray.removeObject(r),this.recordArrays&&this.recordArrays.forEach(function(e){e.removeObject(r)})},findFromCacheOrLoad:function(r){var e;return e=r[i(this,"primaryKey")]?this.cachedRecordForId(r[i(this,"primaryKey")]):this.create({isLoaded:!1}),e.load(r[i(this,"primaryKey")],r),e},registerRecordArray:function(r){this.recordArrays||(this.recordArrays=[]),this.recordArrays.push(r)},unregisterRecordArray:function(r){this.recordArrays&&Ember.A(this.recordArrays).removeObject(r)},forEachCachedRecord:function(r){if(!this.recordCache)return Ember.A([]);var e=Object.keys(this.recordCache);e.map(function(r){return this.recordCache[r]},this).forEach(r)},load:function(r){this.sideloadedData||(this.sideloadedData={});for(var e=0,t=r.length;t>e;e++){var n=r[e];this.sideloadedData[n[i(this,"primaryKey")]]=n}}})}(),function(){var r=Ember.get;Ember.hasMany=function(e,t){return Ember.computed(function(){var i;return i="string"==typeof e?Ember.get(Ember.lookup,e):e,Ember.HasManyArray.create({parent:this,modelClass:i,content:r(this,"data."+t)})}).property()}}(),function(){function r(e){if(Ember.isArray(e)){for(var t=e.slice(),i=0,n=t.length;n>i;i++)t[i]=r(t[i]);return Ember.A(t)}if(e&&e.constructor===Date)return new Date(e.toISOString());if(e&&"object"==typeof e){var o,s=Ember.create(e);for(o in e)e.hasOwnProperty(o)&&"object"==typeof e[o]&&(s[o]=r(e[o]));return s}return e}function e(e,t){return t&&t.deserialize?t.deserialize(e):t&&Ember.Model.dataTypes[t]?Ember.Model.dataTypes[t].deserialize(e):r(e)}var t=Ember.get,i=Ember.set,n=Ember.meta;Ember.Model.dataTypes={},Ember.Model.dataTypes[Date]={deserialize:function(r){return r?new Date(r):null},serialize:function(r){return r?r.toISOString():null}},Ember.Model.dataTypes[Number]={deserialize:function(r){return r||0===r?Number(r):null},serialize:function(r){return r||0===r?Number(r):null}},Ember.attr=function(o){return Ember.computed(function(s,a){var d=t(this,"data"),c=this.dataKey(s),u=d&&t(d,c),h=n(this).proto===this;return 2===arguments.length?(h&&!d&&(d={},i(this,"data",d),d[c]=a),r(a)):e(u,o)}).property("data").meta({isAttribute:!0,type:o})}}(),function(){var r=Ember.get;Ember.RESTAdapter=Ember.Adapter.extend({find:function(r,e){var t=this.buildURL(r.constructor,e),i=this;return this.ajax(t).then(function(t){i.didFind(r,e,t)})},didFind:function(e,t,i){var n=r(e.constructor,"rootKey"),o=n?i[n]:i;e.load(t,o)},findAll:function(r,e){var t=this.buildURL(r),i=this;return this.ajax(t).then(function(t){i.didFindAll(r,e,t)})},didFindAll:function(e,t,i){var n=r(e,"collectionKey"),o=n?i[n]:i;t.load(e,o)},findQuery:function(r,e,t){var i=this.buildURL(r),n=this;return this.ajax(i,t).then(function(i){n.didFindQuery(r,e,t,i)})},didFindQuery:function(e,t,i,n){var o=r(e,"collectionKey"),s=o?n[o]:n;t.load(e,s)},createRecord:function(r){var e=this.buildURL(r.constructor),t=this;return this.ajax(e,r.toJSON(),"POST").then(function(e){t.didCreateRecord(r,e)})},didCreateRecord:function(e,t){var i=r(e.constructor,"rootKey"),n=r(e.constructor,"primaryKey"),o=i?t[i]:t;e.load(o[n],o),e.didCreateRecord()},saveRecord:function(e){var t=r(e.constructor,"primaryKey"),i=this.buildURL(e.constructor,r(e,t)),n=this;return this.ajax(i,e.toJSON(),"PUT").then(function(r){n.didSaveRecord(e,r)})},didSaveRecord:function(r){r.didSaveRecord()},deleteRecord:function(e){var t=r(e.constructor,"primaryKey"),i=this.buildURL(e.constructor,r(e,t)),n=this;return this.ajax(i,e.toJSON(),"DELETE").then(function(r){n.didDeleteRecord(e,r)})},didDeleteRecord:function(r){r.didDeleteRecord()},ajax:function(r,e,t){return this._ajax(r,e,t||"GET")},buildURL:function(e,t){var i=r(e,"url");if(!i)throw new Error("Ember.RESTAdapter requires a `url` property to be specified");return t?i+"/"+t+".json":i+".json"},_ajax:function(r,e,t){var i={url:r,type:t,dataType:"json"};return new Ember.RSVP.Promise(function(r,n){e&&("GET"===t?i.data=e:(i.contentType="application/json; charset=utf-8",i.data=JSON.stringify(e))),i.success=function(e){Ember.run(null,r,e)},i.error=function(r){Ember.run(null,n,r)},Ember.$.ajax(i)})}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||console.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");